@page "/comments"
@rendermode InteractiveServer
@using AvalancheComments.Models

<PageTitle>Avalanche Comments</PageTitle>

<div class="avalanche-container">
    <div class="mountain-header">
        <h1 class="avalanche-title">‚ùÑÔ∏è Avalanche Comments ‚ùÑÔ∏è</h1>
        <p class="subtitle">Share your thoughts on the mountain</p>
    </div>

    <div class="comment-form">
        <h2>Leave a Comment</h2>
        <EditForm Model="@newComment" OnValidSubmit="@HandleValidSubmit">
            <DataAnnotationsValidator />
            
            <div class="form-group">
                <label for="name">Name</label>
                <InputText id="name" class="form-control" @bind-Value="newComment.Name" placeholder="Your name" />
                <ValidationMessage For="@(() => newComment.Name)" />
            </div>

            <div class="form-group">
                <label for="comment">Comment</label>
                <InputTextArea id="comment" class="form-control" @bind-Value="newComment.Text" placeholder="Share your thoughts..." rows="4" />
                <ValidationMessage For="@(() => newComment.Text)" />
            </div>

            <button type="submit" class="btn-avalanche">Submit Comment</button>
        </EditForm>
    </div>

    <div class="comments-section">
        <h2>Recent Comments (@comments.Count)</h2>
        
        @if (comments.Count == 0)
        {
            <div class="no-comments">
                <p>‚ùÑÔ∏è No comments yet. Be the first to share your thoughts! ‚ùÑÔ∏è</p>
            </div>
        }
        else
        {
            <div class="comments-list">
                @foreach (var comment in comments.OrderByDescending(c => c.Timestamp))
                {
                    <div class="comment-card">
                        <div class="comment-header">
                            <span class="comment-author">üèîÔ∏è @comment.Name</span>
                            <span class="comment-time">@comment.Timestamp.ToString("MMM dd, yyyy HH:mm")</span>
                        </div>
                        <div class="comment-body">
                            @comment.Text
                        </div>
                    </div>
                }
            </div>
        }
    </div>
</div>

@code {
    private CommentModel newComment = new();
    private List<CommentModel> comments = new();

    private void HandleValidSubmit()
    {
        var comment = new CommentModel
        {
            Name = newComment.Name,
            Text = newComment.Text,
            Timestamp = DateTime.Now
        };
        
        comments.Add(comment);
        
        // Reset form
        newComment = new CommentModel();
        StateHasChanged();
    }
}
